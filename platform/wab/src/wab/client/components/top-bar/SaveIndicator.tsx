// This is a skeleton starter React component generated by Plasmic.
// This file is owned by you, feel free to edit as you see fit.
import * as React from "react";
import {
  PlasmicSaveIndicator,
  DefaultSaveIndicatorProps,
} from "../../plasmic/plasmic_kit_top_bar/PlasmicSaveIndicator";
import { HTMLElementRefOf } from "@plasmicapp/react-web";
import { observer } from "mobx-react-lite";
import { useStudioCtx } from "../../studio-ctx/StudioCtx";
import { MaybeWrap } from "../../../commons/components/ReactUtil";
import { Tooltip } from "antd";

export interface SaveIndicatorProps extends DefaultSaveIndicatorProps {}

function SaveIndicator_(
  props: SaveIndicatorProps,
  ref: HTMLElementRefOf<"div">
) {
  const studioCtx = useStudioCtx();

  return (
    <MaybeWrap
      cond={studioCtx.needsSaving() || studioCtx.isUnlogged()}
      wrapper={(x) => <Tooltip title="Saving...">{x}</Tooltip>}
    >
      <PlasmicSaveIndicator
        root={{ ref }}
        saveState={
          studioCtx.isUnlogged()
            ? "unlogged"
            : studioCtx.needsSaving()
            ? "dirty"
            : undefined
        }
        {...props}
      />
    </MaybeWrap>
  );
}

const SaveIndicator = observer(SaveIndicator_, { forwardRef: true });
export default SaveIndicator;
